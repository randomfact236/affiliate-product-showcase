/**
 * Card Component
 * 
 * Product card styles with full BEM methodology.
 * Consolidates: product-card.css + showcase frontend card styles
 * 
 * @package AffiliateProductShowcase
 * @since 2.0.0
 */

@use '../01-settings/tokens-vars' as tokens;
@use '../02-tools/mixins';
@use '../02-tools/functions';
@use '../07-utilities/animations' as *;

// ============================================
// Card Container
// ============================================

.aps-card {
	@include mixins.card-base;

	display: flex;
	flex-direction: column;
	height: 100%;

	&:hover {
		border-color: tokens.$color-primary;
	}

	&:focus-within {
		outline: 3px solid tokens.$color-primary;
		outline-offset: 2px;
		border-radius: tokens.$radius-lg;
	}

	// List layout variant
	&--list {
		flex-direction: row;
		gap: tokens.$spacing-6;
		padding: tokens.$spacing-6;
		align-items: stretch;

		&:hover {
			transform: none;
			box-shadow: tokens.$shadow-md;
		}

		@include mixins.respond-down('md') {
			flex-direction: column;
		}
	}

	// Compact variant
	&--compact {
		padding: tokens.$spacing-4;

		.aps-card__media {
			height: functions.spacing('44'); // 180px approx
		}

		.aps-card__title {
			font-size: tokens.$font-size-md;
		}

		.aps-card__price {
			font-size: tokens.$font-size-xl;
		}
	}
}

// ============================================
// Card Media
// ============================================

.aps-card__media {
	position: relative;
	width: 100%;
	aspect-ratio: 16 / 9;
	overflow: hidden;
	background: tokens.$color-bg-secondary;

	@supports not (aspect-ratio: 1) {
		&::before {
			content: '';
			display: block;
			padding-bottom: 56.25%;
		}

		img {
			position: absolute;
			top: 0;
			left: 0;
		}
	}

	img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform tokens.$transition-base;
	}

	.aps-card:hover & img {
		transform: scale(1.05);
	}

	// List layout adjustments
	.aps-card--list & {
		width: tokens.$card-media-width;
		height: tokens.$card-media-height;
		flex-shrink: 0;

		@include mixins.respond-down('md') {
			width: 100%;
			height: tokens.$card-media-width;
		}
	}
}

// ============================================
// Card Body
// ============================================

.aps-card__body {
	padding: tokens.$spacing-5;
	flex: 1;
	display: flex;
	flex-direction: column;
	gap: tokens.$spacing-3;

	// List layout
	.aps-card--list & {
		padding: 0;
	}
}

.aps-card__title {
	margin: 0;
	font-size: tokens.$font-size-lg;
	font-weight: tokens.$font-weight-semibold;
	line-height: tokens.$line-height-tight;
	color: tokens.$color-text-primary;

	@include mixins.line-clamp(2);

	a {
		color: inherit;
		transition: color tokens.$transition-fast;

		&:hover {
			color: tokens.$color-primary;
		}
	}
}

.aps-card__description {
	margin: 0;
	font-size: tokens.$font-size-base;
	line-height: tokens.$line-height-normal;
	color: tokens.$color-text-tertiary;

	@include mixins.line-clamp(3);

	// List layout
	.aps-card--list & {
		-webkit-line-clamp: 3;
		line-clamp: 3;
	}
}

// ============================================
// Card Meta (Badges)
// ============================================

.aps-card__meta {
	display: flex;
	flex-wrap: wrap;
	gap: tokens.$spacing-2;
	align-items: center;
}

.aps-card__badge {
	display: inline-block;
	padding: tokens.$spacing-1 tokens.$spacing-3;
	background: linear-gradient(135deg, tokens.$color-primary 0%, tokens.$color-primary-dark 100%);
	color: tokens.$color-white;
	font-size: tokens.$font-size-xs;
	font-weight: tokens.$font-weight-semibold;
	border-radius: tokens.$radius-sm;
	text-transform: uppercase;
	letter-spacing: tokens.$letter-spacing-wide;
}

.aps-card__rating {
	display: inline-flex;
	align-items: center;
	gap: tokens.$spacing-1;
	padding: tokens.$spacing-1 tokens.$spacing-2;
	background: tokens.$color-rating-bg;
	border: 1px solid tokens.$color-rating-border;
	border-radius: tokens.$radius-sm;
	font-size: tokens.$font-size-sm;
	color: tokens.$color-rating-text;
	font-weight: tokens.$font-weight-medium;

	&[aria-hidden='true'] {
		color: tokens.$color-rating-border;
	}
}

.aps-card__version {
	display: inline-flex;
	align-items: center;
	gap: tokens.$spacing-1;
	padding: tokens.$spacing-1 tokens.$spacing-2;
	background: tokens.$color-version-bg;
	border: 1px solid tokens.$color-version-border;
	border-radius: tokens.$radius-sm;
	font-size: tokens.$font-size-xs;
	color: tokens.$color-version-text;
	font-weight: tokens.$font-weight-medium;
	font-family: tokens.$font-family-base;
	transition:
		background-color 150ms ease-in-out,
		border-color 150ms ease-in-out,
		color 150ms ease-in-out;

	&:hover {
		background: tokens.$color-primary;
		color: tokens.$color-white;
		border-color: tokens.$color-primary;
	}
}

// ============================================
// Card Footer
// ============================================

.aps-card__footer {
	margin-top: auto;
	padding: tokens.$spacing-4 tokens.$spacing-5;
	border-top: 1px solid tokens.$color-bg-hover;
	display: flex;
	flex-wrap: wrap;
	gap: tokens.$spacing-3;
	align-items: center;
	justify-content: space-between;
}

.aps-card__price-container {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	gap: tokens.$spacing-2;
}

.aps-card__price {
	display: flex;
	align-items: baseline;
	gap: tokens.$spacing-1;
	font-size: tokens.$font-size-2xl;
	font-weight: tokens.$font-weight-bold;
	color: tokens.$color-text-primary;
	line-height: 1;

	&-currency {
		font-size: tokens.$font-size-sm;
		font-weight: tokens.$font-weight-medium;
		color: tokens.$color-text-muted;
	}

	&--original {
		font-size: tokens.$font-size-md;
		color: tokens.$color-text-muted;
		text-decoration: line-through;
	}
}

.aps-card__discount {
	display: inline-flex;
	align-items: center;
	padding: tokens.$spacing-1 tokens.$spacing-2;
	background: tokens.$color-discount;
	color: tokens.$color-white;
	font-size: tokens.$font-size-xs;
	font-weight: tokens.$font-weight-bold;
	border-radius: tokens.$radius-sm;
	box-shadow: 0 2px 4px rgba(tokens.$color-danger, 0.3);
	animation: aps-pulse 2s infinite;

	@include mixins.reduced-motion {
		animation: none;
	}
}

.aps-card__cta {
	@include mixins.button-base;

	background: tokens.$color-primary;
	color: tokens.$color-white;

	&:hover {
		background: tokens.$color-primary-hover;
		transform: translateY(-1px);
		box-shadow: tokens.$shadow-md;
	}

	&:active {
		transform: translateY(0);
	}

	// Touch device sizing
	@include mixins.touch-only {
		min-height: 44px;
		padding: tokens.$spacing-3 tokens.$spacing-6;
	}
}

// ============================================
// Platform Section
// ============================================

.aps-card__platform {
	margin-top: tokens.$spacing-3;
	padding: tokens.$spacing-3;
	background: tokens.$color-bg-tertiary;
	border: 1px solid tokens.$color-border-light;
	border-radius: tokens.$radius-md;
	font-size: tokens.$font-size-sm;
}

.aps-card__platform-details {
	transition: background-color 200ms ease-in-out;

	&[open] {
		background: tokens.$color-bg-primary;
	}
}

.aps-card__platform-toggle {
	cursor: pointer;
	display: flex;
	align-items: center;
	gap: tokens.$spacing-1;
	font-weight: tokens.$font-weight-medium;
	color: tokens.$color-primary;
	padding: tokens.$spacing-1 0;
	user-select: none;
	-webkit-tap-highlight-color: transparent;

	&:hover {
		color: tokens.$color-primary-hover;
	}

	@include mixins.focus-outline;

	.dashicons {
		font-size: tokens.$font-size-base;
		width: tokens.$font-size-base;
		height: tokens.$font-size-base;
		transition: transform tokens.$transition-base;
	}

	// Touch device sizing
	@include mixins.touch-only {
		min-height: 44px;
		display: inline-flex;
		align-items: center;
	}
}

.aps-card__platform-details[open] .aps-card__platform-toggle .dashicons {
	transform: rotate(90deg);
}

.aps-card__platform-content {
	margin-top: tokens.$spacing-2;
	padding: tokens.$spacing-2 tokens.$spacing-3;
	background: tokens.$color-bg-primary;
	border: 1px solid tokens.$color-border-light;
	border-radius: tokens.$radius-sm;
	font-size: tokens.$font-size-sm;
	line-height: tokens.$line-height-relaxed;
	color: tokens.$color-text-tertiary;
	animation: aps-slide-down tokens.$transition-base ease;
}

// ============================================
// Disclosure Notice
// ============================================

.aps-disclosure {
	padding: tokens.$spacing-3;
	margin-bottom: tokens.$spacing-3;
	font-size: tokens.$font-size-xs;
	line-height: tokens.$line-height-normal;
	color: tokens.$color-text-tertiary;
	background: tokens.$color-bg-secondary;
	border: 1px solid tokens.$color-border-light;
	border-radius: tokens.$radius-sm;

	&--top {
		margin-top: 0;
		margin-bottom: tokens.$spacing-4;
	}

	&--bottom {
		margin-top: tokens.$spacing-4;
		margin-bottom: 0;
	}
}

// ============================================
// Responsive
// ============================================

@include mixins.respond-down('md') {
	.aps-card__footer {
		flex-direction: column;
		align-items: stretch;
	}

	.aps-card__cta {
		width: 100%;
		text-align: center;
	}

	.aps-card__price-container {
		justify-content: center;
		width: 100%;
	}
}

@include mixins.respond-down('xs') {
	.aps-card__media {
		aspect-ratio: 4 / 3;
	}

	.aps-card__title {
		font-size: tokens.$font-size-md;
	}

	.aps-card__price {
		font-size: tokens.$font-size-xl;
	}
}

// ============================================
// Print
// ============================================

@include mixins.print {
	.aps-card {
		break-inside: avoid;
		border: 1px solid tokens.$color-black;
		box-shadow: none;
	}

	.aps-card__cta,
	.aps-card__platform-details {
		display: none;
	}
}

// ============================================
// Accessibility
// ============================================

@include mixins.reduced-motion {

	.aps-card,
	.aps-card__media img,
	.aps-card__platform-details,
	.aps-card__platform-toggle .dashicons {
		transition: none;
	}

	.aps-card:hover .aps-card__media img {
		transform: none;
	}
}

@include mixins.high-contrast {
	.aps-card {
		border-width: 2px;
	}

	.aps-card__badge,
	.aps-card__discount {
		border: 2px solid tokens.$color-black;
	}
}

// ============================================
// Keyframes
// ============================================