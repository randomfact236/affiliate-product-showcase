#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ðŸš€ Running pre-push quality gates..."

# Navigate to plugin directory
cd "$(dirname "$0")/.."

# Full PHP linting (WordPress standards)
echo "â†’ Running PHPCS (WordPress standards)..."
npm run lint:php || exit 1

# Static analysis (PHPStan Level 8)
echo "â†’ Running PHPStan analysis..."
cd ../../.. && composer --working-dir=wp-content/plugins/affiliate-product-showcase phpstan || exit 1
cd wp-content/plugins/affiliate-product-showcase

# JavaScript linting
echo "â†’ Running ESLint..."
npm run lint:js || exit 1

# CSS linting
echo "â†’ Running Stylelint..."
npm run lint:css || exit 1

# TypeScript type checking
echo "â†’ Running TypeScript check..."
npm run typecheck || exit 1

# Full test suite
echo "â†’ Running PHPUnit tests..."
npm run test || exit 1

# Coverage assertion (â‰¥95%)
echo "â†’ Checking coverage threshold..."
npm run assert-coverage || exit 1

echo "âœ… All quality gates passed! Push approved."
