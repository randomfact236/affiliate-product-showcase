!function(t){"use strict";const{showNotice:s,ajax:o,getCurrentStatusView:n,shouldKeepRowInCurrentView:e,parseQueryParamsFromUrl:a}=window.APS_Utils,i="undefined"!=typeof apsAdminVars?apsAdminVars:{};function r(){const s=t("#aps_ribbon_color"),o=t("#aps_ribbon_bg_color"),n=t("#ribbon-preview"),e=o.val()||"#ff0000",a=function(t){let s=t.replace("#","");3===s.length&&(s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]);const o=parseInt(s.substr(0,2),16),n=parseInt(s.substr(2,2),16),e=parseInt(s.substr(4,2),16);return(.299*o+.587*n+.114*e)/255>.5?"#000000":"#ffffff"}(e),i=s.val()||a;n.css({"--aps-ribbon-text":i,"--aps-ribbon-bg":e}).addClass("aps-ribbon-preview--active")}t(function(){t(document).on("focus",".aps-ribbon-status-select",function(){t(this).data("aps-prev",t(this).val())}),t(document).on("change",".aps-ribbon-status-select",function(){const n=t(this),a=n.data("term-id"),r=n.val(),c=n.data("aps-prev");n.prop("disabled",!0),o({data:{action:"aps_toggle_ribbon_status",nonce:i.nonce||"",term_id:a,status:r}}).done(o=>{if(n.prop("disabled",!1),!o?.success)throw o;s("success",o.data?.message||i.success_text||"Ribbon updated."),e(r)||n.closest("tr").fadeOut(150,function(){t(this).remove()})}).fail(t=>{n.prop("disabled",!1),void 0!==c&&n.val(c);const o=t.responseJSON?.data?.message||i.error_text||"Request failed.";s("error",o)})}),t(document).on("click",'a[href*="admin-post.php?action=aps_ribbon_row_action"]',function(n){const r=t(this),c=r.attr("href");if(!c)return;n.preventDefault();const l=a(c),b=l.get("term_id"),d=l.get("row_action");b&&d?(r.addClass("disabled"),o({data:{action:"aps_ribbon_row_action",nonce:i.row_action_nonce||"",term_id:b,row_action:d}}).done(o=>{if(r.removeClass("disabled"),!o?.success)throw o;const n=o.data||{};s("success",n.message||"Done.");let a=t(`#tag-${b}`);a.length||(a=r.closest("tr")),"delete_permanently"!==d?n.status&&(a.find(".aps-ribbon-status-select").val(n.status),e(n.status)||a.fadeOut(150,function(){t(this).remove()})):a.fadeOut(150,function(){t(this).remove()})}).fail(t=>{r.removeClass("disabled");const o=t.responseJSON?.data?.message||i.error_text||"Request failed.";s("error",o)})):window.location.href=c}),t("body").hasClass("taxonomy-aps_ribbon")&&(!function(){const s=t("#aps_ribbon_color"),o=t("#aps_ribbon_bg_color"),n=t("#aps_ribbon_bg_color_text"),e=t(".preset-color");s.on("input",r),o.on("input",function(){n.val(t(this).val()),r()}),n.on("input",function(){const s=t(this).val();/^#[0-9a-fA-F]{6}$/.test(s)&&(o.val(s),r())}),e.on("click",function(){const s=t(this).data("color");o.val(s),n.val(s),r()}),r()}(),t("#the-list tr").each(function(){const s=t(this),o=s.find(".column-color .aps-ribbon-color-swatch"),n=s.find(".column-bg_color .aps-ribbon-bg-color-swatch"),e=s.find(".column-ribbon_icon .aps-ribbon-icon-display"),a=s.find(".column-name .row-title");if(a.length&&(o.length||n.length)){const s=o.length?o.css("background-color"):"",i=n.length?n.css("background-color"):"",r=e.length?e.text().trim():"";if(r&&0===a.find(".ribbon-icon-prefix").length){const s=APS_Utils.escapeHtml?APS_Utils.escapeHtml(r):r,o=a.text();a.empty().append(t("<span>").addClass("ribbon-icon-prefix").text(s)).append(document.createTextNode(" "+o))}a.css({"--aps-ribbon-text":s,"--aps-ribbon-bg":i}).addClass("aps-ribbon-badge")}}))})}(jQuery);