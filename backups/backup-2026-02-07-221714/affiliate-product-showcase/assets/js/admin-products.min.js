!function(e){"use strict";const{debounce:t,escapeHtml:c}=window.APS_Utils||{debounce:function(e,t){let c;return function(...n){clearTimeout(c),c=setTimeout(()=>e.apply(this,n),t)}},escapeHtml:function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}},n="undefined"!=typeof apsProductsData?apsProductsData:{ajaxUrl:window.ajaxurl||"/wp-admin/admin-ajax.php",nonce:"",strings:{bulkActionRequired:"Please select a bulk action.",noItemsSelected:"Please select at least one item.",bulkDeleteConfirm:"Are you sure you want to delete %d products?",bulkDeleteSuccess:"%d products moved to trash.",deleteConfirm:"Are you sure you want to delete this product?",deleteSuccess:"Product deleted successfully."}},r={selectedProducts:[],searchTerm:"",categoryFilter:"all",statusFilter:"all",currentFilter:"all"};let o={};function a(e){e.preventDefault();const t=e.target.getAttribute("data-filter");t&&u({status:t,status_filter:null})}function l(e){const t=e.target.value,c="category-filter-top"===e.target.id?"category":"status_filter";u({[c]:t})}function s(e){r.searchTerm=e.target.value.trim(),"Enter"===e.key&&d(e)}function d(e){e.preventDefault(),u({s:r.searchTerm||null})}function i(e){e.preventDefault(),u({category:"all"!==o.categoryFilter?.value?o.categoryFilter.value:null,status_filter:"all"!==o.statusFilter?.value?o.statusFilter.value:null})}function u(e){const t=new URL(window.location.href);Object.entries(e).forEach(([e,c])=>{null===c?t.searchParams.delete(e):t.searchParams.set(e,c)}),window.location.href=t.toString()}function m(e){const t=e.target.checked;document.querySelectorAll(".row-checkbox").forEach(e=>e.checked=t),y()}function p(){y();const e=Array.from(document.querySelectorAll(".row-checkbox")),t=e.every(e=>e.checked),c=e.some(e=>e.checked);document.querySelectorAll("#cb-select-all-1, #cb-select-all-2").forEach(e=>{e.checked=t,e.indeterminate=c&&!t})}function y(){r.selectedProducts=Array.from(document.querySelectorAll(".row-checkbox:checked")).map(e=>parseInt(e.value,10))}function f(e){e.preventDefault();const t="doaction"===e.target.id?"bulk-action-selector-top":"bulk-action-selector-bottom",c=document.getElementById(t)?.value;return c&&"-1"!==c?r.selectedProducts.length?void("trash"===c&&confirm(n.strings.bulkDeleteConfirm.replace("%d",r.selectedProducts.length))&&function(e,t){const c=new FormData;return c.append("action",e),c.append("nonce",n.nonce),c.append("product_ids",JSON.stringify(t)),fetch(n.ajaxUrl,{method:"POST",body:c}).then(e=>e.json()).then(e=>{if(e.success)return r.selectedProducts.length;throw new Error(e.data?.message||"Failed")}).catch(e=>(b(e.message,"error"),0))}("aps_bulk_trash_products",r.selectedProducts).then(e=>{b(n.strings.bulkDeleteSuccess.replace("%d",e),"success"),setTimeout(()=>window.location.reload(),1e3)})):b(n.strings.noItemsSelected,"error"):b(n.strings.bulkActionRequired,"error")}function h(e){e.preventDefault();const t=parseInt(e.target.getAttribute("data-id"),10);if(confirm(n.strings.deleteConfirm)){const e=new FormData;e.append("action","aps_trash_product"),e.append("nonce",n.nonce),e.append("product_id",t),fetch(n.ajaxUrl,{method:"POST",body:e}).then(e=>e.json()).then(e=>{e.success?(b(n.strings.deleteSuccess,"success"),document.querySelector(`.row-checkbox[value="${t}"]`)?.closest("tr")?.remove()):b(e.data?.message||"Failed","error")}).catch(()=>b("Error occurred","error"))}}function E(e){e.preventDefault();const t=e.target.getAttribute("data-id"),c=e.target.closest("tr"),n=document.getElementById("quick-edit-product-id"),r=document.getElementById("quick-edit-title"),a=document.getElementById("quick-edit-price");n&&(n.value=t),r&&(r.value=c.querySelector(".row-title")?.textContent||""),a&&(a.value=c.querySelector(".aps-price")?.textContent.replace(/[^0-9.]/g,"")||0),o.quickEditModal&&(o.quickEditModal.style.display="flex")}function g(){const e=document.getElementById("quick-edit-product-id")?.value,t=document.getElementById("quick-edit-title")?.value.trim(),c=parseFloat(document.getElementById("quick-edit-price")?.value)||0;if(!t)return b("Title is required","error");const r=new FormData;r.append("action","aps_quick_edit_product"),r.append("nonce",n.nonce),r.append("product_id",e),r.append("title",t),r.append("price",c),fetch(n.ajaxUrl,{method:"POST",body:r}).then(e=>e.json()).then(e=>{e.success?(b("Saved","success"),k(),setTimeout(()=>window.location.reload(),1e3)):b(e.data?.message||"Failed","error")}).catch(e=>{b("Network error: "+(e.message||"Request failed"),"error")})}function k(){o.quickEditModal&&(o.quickEditModal.style.display="none"),o.quickEditForm&&o.quickEditForm.reset()}function v(e){"Escape"===e.key&&k()}function b(e,t="success"){const c=o.toastContainer;if(!c)return;const n=document.createElement("div");n.className=`aps-toast aps-toast-${t}`;const r=document.createElement("div");r.className="aps-toast-message",r.textContent=e,n.appendChild(r),c.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),300)},3e3)}window.addEventListener("beforeunload",function(){document.removeEventListener("keydown",v)}),e(document).ready(function(){o=function(){if(window._apsElementsCache)return window._apsElementsCache;const e={table:document.querySelector(".wp-list-table"),form:document.getElementById("aps-products-form"),bulkActionSelectors:[document.getElementById("bulk-action-selector-top"),document.getElementById("bulk-action-selector-bottom")],applyButtons:[document.getElementById("doaction"),document.getElementById("doaction2")],categoryFilter:document.getElementById("category-filter-top"),statusFilter:document.getElementById("status-filter-top"),searchInput:document.getElementById("post-search-input"),searchSubmit:document.getElementById("search-submit"),filterSubmit:document.getElementById("filter-submit"),navTabs:document.querySelectorAll(".aps-nav-tabs .nav-tab"),toastContainer:document.getElementById("aps-toast-container"),quickEditModal:document.getElementById("aps-quick-edit-modal"),quickEditForm:document.getElementById("aps-quick-edit-form"),quickEditSave:document.querySelector(".aps-modal-save"),quickEditCancel:document.querySelector(".aps-modal-cancel"),quickEditClose:document.querySelector(".aps-modal-close"),quickEditOverlay:document.querySelector(".aps-modal-overlay")};return window._apsElementsCache=e,e}(),o.navTabs.forEach(e=>e.addEventListener("click",a)),o.categoryFilter?.addEventListener("change",l),o.statusFilter?.addEventListener("change",l),o.searchInput?.addEventListener("keyup",t(s,300)),o.searchSubmit?.addEventListener("click",d),o.applyButtons.forEach(e=>e?.addEventListener("click",f)),document.querySelectorAll("#cb-select-all-1, #cb-select-all-2").forEach(e=>e?.addEventListener("change",m)),document.querySelectorAll(".row-checkbox").forEach(e=>{e.addEventListener("change",p)}),document.querySelectorAll(".aps-inline-edit").forEach(e=>{e.addEventListener("click",E)}),document.querySelectorAll(".aps-trash-product").forEach(e=>{e.addEventListener("click",h)}),o.quickEditClose?.addEventListener("click",k),o.quickEditOverlay?.addEventListener("click",k),o.quickEditCancel?.addEventListener("click",k),o.quickEditSave?.addEventListener("click",g),document.addEventListener("keydown",v),o.filterSubmit?.addEventListener("click",i),function(){const e=new URLSearchParams(window.location.search);r.currentFilter=e.get("status")||"all",r.categoryFilter=e.get("category")||"all",r.statusFilter=e.get("status_filter")||"all",r.searchTerm=e.get("s")||"",o.categoryFilter&&(o.categoryFilter.value=r.categoryFilter);o.statusFilter&&(o.statusFilter.value=r.statusFilter)}(),function(){const e=document.querySelectorAll(".wp-list-table thead th"),t={};e.forEach((e,c)=>{const n=e.className.replace(/manage-column|column-/g,"").trim();n&&(t[c]=n.charAt(0).toUpperCase()+n.slice(1))}),document.querySelectorAll(".wp-list-table tbody tr").forEach(e=>{e.querySelectorAll("td").forEach((e,c)=>{t[c]&&e.setAttribute("data-colname",t[c])})})}()})}(jQuery);